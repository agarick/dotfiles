#! /usr/bin/env tclsh

source "$::env(HOME)/bin/lib.tcl"

need dunstify setxkbmap xmodmap

set arg [lindex $::argv 0]
set re_planck {^Planck$}

switch -- $arg {
  hsnt {
    exec setxkbmap -option us
    if [catch {exec cat /sys/bus/usb/devices/*/product | grep -q $re_planck}] {
      exec setxkbmap -option ctrl:swapcaps
    }
    exec xmodmap $::env(HOME)/cfg/unstowed/hsnt/hsnt.xmodmap
  }

  qwerty {
    if ![catch {exec cat /sys/bus/usb/devices/*/product | grep -q $re_planck}] {
      exec setxkbmap -option ctrl:swapcaps us
    } else {
      exec setxkbmap -option us
    }
  }

  bow {
    exec xmodmap -e {keycode 49 = Escape Escape Escape}
    exec xmodmap -e {clear mod1}
    exec xmodmap -e {keycode 108 = grave asciitilde grave asciitilde}
    exec xmodmap -e {add mod1 = Alt_L}
  }
}

exec xset r rate 300 30

exec dunstify -r 99437 -u low -t 2000 -i input-keyboard $arg

